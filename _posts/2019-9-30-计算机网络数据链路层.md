---
layout:     post
title:      计算机网络数据链路层
subtitle:   
date:       2019-9-30
author:     度朝腾
catalog: true
tags:
    - 计算机网络
---

### 一、数据链路层的功能

1. - 无确认的无连接服务
   - 有确认的无连接服务
   - 有确认的面向连接服务
   - **有连接就一定有确认**
2. 链路管理：**数据链路层连接的建立、维持、释放过程称为链路管理**
   - 主要用于面向连接的服务
   - 首先确认对方已处于就绪状态，并交换一些必要的信息以对帧序号初始化
   - 建立连接
   - 在传输过程中维持连接
   - 传输完毕释放该连接
3. 帧界定、帧同步、透明传输
   - 帧界定：确定帧的界限
   - 帧同步：接收方能从接收到的二进制比特流区分出帧的起始和终止
   - 透明传输：不管数据是什么比特组合，都能在链路上传输
4. 流量控制
   - 限制发送方的数据流量，防止其发送速率超过接收方的接受能力
   - 控制的相邻两结点之间数据链路上的流量
5. 差错控制
   - 使发送方确定接收方是否正确收到其发送的数据的方法称为差错控制
   - 位错：帧中某些位产生差错，通常用循环冗余校验发现位错，通过自动重传请求方式来重传出错的帧
   - 帧错：帧的丢失、重复、失序等错误，引入定时器和编号机制，能保证每一帧最终都能且仅有一次正确地交付
6. 易错点

   - 为了避免传输过程中帧的丢失，数据链路层采用的方法是**计时器超时重发**，别把差错控制的方法搞混了
   - 对于信道比较可靠且对实时性要求高的网络。数据链路层采用**无确认的无连接服务**比较适合
   - 物理信道的传输成功率是指单个帧的成功情况，如果想求网络层分组的成功率，要全乘起来

### 二、组帧

1. 字符统计法（脆弱性）（计数字段也算进计数中）
   - 在帧头部使用一个计数字段来标明帧内字符数，可以确定帧结束的位置
   - **最大问题在于**如果计数字段出错，收发双方将失去同步，造成灾难性后果
2. 字符填充的首尾定界符法（复杂性）
   - 使用特定字符来定界一帧的开始与结束
   - 书上那啥DEL STX什么的，就是一个首尾标志，没有转义字符
   - DEL转义字符可以**防止特殊字符的误判**（特殊字符就是本身作为其他用处的字符），并且只是一个字符而不是三个，特殊字符就是我们规定好的那些，不一定只有一个
3. 比特填充的首尾标志法
   - 用0111110来标志一帧的开始与结束
   - 发送方的数据链路层在信息位遇到五个连续的1时，自动在其后面插入一个0
   - 接收方没收到五个连续的1时，自动删除后面紧跟的0，恢复原信息
   - 性能优于字符填充法
4. 违规编码法
   - 利用违规（不使用的编码规则）编码来定界帧的起始和结束
   - 不需要采用任何填充技术，就能实现数据传输的**透明性**
   - 只适合采用冗余编码的特殊编码环境（**有不使用的编码规则**）

### 三、差错控制（传输中的差错基本都是有噪声引起的）

1. 两种噪声
   - 信道随机热噪声：提高信噪比来减少或避免
   - 外界特定短暂原因所造成的冲击噪声：**产生差错的重要原因**
2. 差错控制
   - 自动重传请求（ARQ）
   - 前向纠错（FEC）
3. 检错编码（哟哟哟，这不是计组嘛）
   - 奇偶校验码：只能发现数据代码中奇数位的出错情况，不能纠正错误
   - 循环冗余码
     - 在K（信息码长度）位信息码后面再拼接R（生成多项式最高幂次）位的校验码，整个编码的长度位N位，这种编码又叫（N，K）码
     - 基于线性编码理论，在发送端，将要传送的K位二进制信息吗左移R位
     - 将它与生成多项式G(x)做模2除法，生成一个R位校验码，并附在信息码后，构成新的二进制码（CRC）
     - 在接收端，利用生成多项式对接受到的编码做模2除法，用来检查出错位的位置，无错则整除
     - 生成多项式是接收端和发送端的一个约定
     - 同样，也是纠错位取反
4. 纠错编码
   - 海明码：L（最小码距） - 1 = D + C 且D（检测错误的位数） >= C（纠正错误的位数）
   - 实际上是多重奇偶校验码
   - 在有效信息位中加入几个校验位形成海明码
   - 把海明码的每个二进制位分配到**几个奇偶校验组中**
   - 当某一位出错后，就会引起有关的几个校验位的值发生变化
   - 因此既能发现错位又可以指出错位的位置，为自动纠错提供依据
   - 将错位取反就可以直接纠错

### 四、流量控制与可靠传输机制

1. 基本方法是由接收方控制发送方发送数据的速率

2. 停止-等待流量控制基本原理（类似与发送窗口与接受窗口都只有1）
   - 发送方每发送一帧，都要等待接收方的应答信号，之后才发送下一帧
   - 接收方每接受一帧，都要反馈发送方一应答信号，表示可接受下一帧
   - 如果接收方一直不反馈应答信号，那么发送方就必须一直等待
   - 每次只允许发送一帧
   - **传输效率很低**
   
3. 滑动窗口流量控制基本原理
   - 在任意时刻，发送方都维持一组连续的允许发送的帧的信号，称为**发送窗口**
   - 在任意时刻，接收方都维持一组连续的允许接受的帧的信号，称为**接收窗口**
   - 发送窗口的大小代表还未收到对方确认信息的情况下发送方最多还可以发送多少个数据帧
   - 接受方只有收到的数据帧的序号落入接受窗口内才允许将该数据帧收下，其他的**丢弃**
   - 发送端每接受到一个确认帧，**发送窗口就向前滑动一个帧的位置**，当发送窗口内没有可以发送的帧时，发送方就会停止发送，直到收到接收方发送的**确认帧使窗口移动**，**窗口内有可以发送的帧的时候**，才开始继续发送
   - 接收端收到数据帧后，将窗口向前移动一个位置，并且返回确认帧
   
4. 可靠传输机制
   - 确认是一种**无数据**的控制帧，这种控制帧使得接收方可以让发送方知道哪些内容被正确接收
   - 为了提高效率，有时候将确认捎带在一个回复帧中，称为**捎带确认**
   - 超时重传是指发送方在发送某个数据帧后就开启一个计时器，在一定时间内如果没有得到发送的数据帧的确认帧，那么就重新发送该数据帧，**直到发送成功为止**
   - 自动重传请求：
     1. 停止-等待
     2. 后退N帧
     3. 选择性重传
   
5. 单帧滑动窗口和停止-等待协议

   1. 停止-等待协议可能出现的错误：

      - 数据帧丢失
      - 到达目的站的帧可以已经损坏，接收站检测出错误后，只是单纯地将该帧丢弃
      - 数据帧正确但是确认帧被破坏

   2. 发送结点：

      1. 从主机取一个数据帧，送交发送缓存

      2. 发送状态变量初始化

      3. 将发送状态变量值写入数据帧中的发送序号

      4. 将发送缓存中的数据帧发送出去（这个数据帧的副本还保留在发送缓存中）

      5. 设置超时计时器（选择适当的超时重传时间）

      6. 等待

      7. 收到确认帧ACKn后，

         若n = 1 - V(S)，则从主机取一个新的数据帧，放入发送缓存

         V(S) = 1 - V(S)

         否则，丢弃这个确认帧，转到等待那一步

      8. 如果超时计时器时间到，转到重传已发送的数据帧那一步

   3. 接收结点：

      1. 接收状态变量初始化（数值等于欲接收的数据帧的发送序号）
      2. 等待
      3. 收到一个数据帧时，检查有无传输差错，出错则丢弃并等待，正确无误执行后续
      4. 若接收状态变量 = 发送发送状态变量，执行后续算法，否则丢弃此数据帧，转到7
      5. 将受到的数据帧中的数据部分交送给主机
      6. 更新就收状态变量，准备接收下一个数据帧
      7. 发送确认帧ACKn，并转到2（n = V(R)，表明希望接收到V(R)）

6. 多帧滑动窗口和后退N帧协议（不一定优于停止-等待协议）

   1. 发送方无需在收到上一个帧的ACK后才能开始发送下一帧，可以连续发送帧
   2. 当接收方检测出失序的信息帧后，要求发送方重发**最后一个能正确接收**的信息帧之后 的**所有未被确认的帧**
   3. 当发送方发送N个帧后，若发现**该N个帧的前一个帧**在计时器超时后仍未返回其确认信息，则该帧被判为出错或丢失，此时发送方不得不重传**该出错帧及随后的N个帧**
   4. 接收方只允许按顺序接受帧

7. 多帧滑动窗口和选择重传协议

   1. 为了进一步提高信道利用率，可以设法只重传出现差错的数据帧或计时器超时的数据帧
   2. 但是此时必须加大接收窗口，以便收下发送序号不连续但仍处在接收窗口中的那些数据帧
   3. 等到所缺序号的数据帧收到后再一并送交主机
   4. 为了保证接收方向前移动窗口后，新窗口序号和旧窗口序号没有重叠部分

### 八、介质访问控制（怎么更好地分配信道的使用权）

1. 信道划分介质访问控制

   1. 多路复用技术（现在杭州市有10个不同地方的人都去杭州市某一个邮局寄信，寄往上海的10个不同地方，到了上海之后，再由邮递员将十封信送往各自目的地）
      - 频分多路复用：将一条信道分割成多条不同频率的信道，类似于将一条马路分割成多个车道，使用频分复用时，如果复用数增加，那么信道的带宽必需得增加，每个子信道的带宽可以不相同，但是它们的总和不能超过信道的总带宽，在实际应用中，为防止子信道之间的干扰，相邻信道之间要加入保护频带
      - 时分多路复用：统计时分复用是一种动态的时间分配方式，同时又是异步的，所以统计时分复用又称为异步时分复用，普通的时分复用就是同步时分复用
      - 波分多路复用：光的频分多路复用，在一根光纤中传输多种不同频率的光信号，由于各路光的频率不同，因此各路光信号不互相干扰。最后，再用分波器将各路波长不一样的光分解出来
      - 码分多路复用：又称为码分多址，既共享信道的频率，又共享时间。是一种真正的动态复用技术
        - 任意两个不同站的码片向量正交
        - 任意站点的码片向量与该码片向量自身的规格化内积一定为1，任何站点的码片分量与该码片的反码向量的规格化一定为-1
2. 随机访问介质控制访问
   1. 动态划分信道，分为随机接入与受控接入
   2. 随机接入：所有用户都可以根据自己的意愿随即地发送信息，这样就会产生冲突，从而导致所有冲突用户发送数据失败，CSMA/CD被引入用于解决
      - ALOHA协议：
        1. 不进行任何检测就发送数据，如果在一段时间没有收到确认，结点就认为传输过程中发生了冲突，**等待一段随机事件后再发送数据**
        2. 时分ALOHA：所有结点的时间被划分为间隔相同的时隙，规定每个结点只有等到下一个时隙到来时才可发送数据
      - CSMA协议：
        1. 1-坚持CSMA，立即发送数据
        2. p-坚持CSMA，以概率p发送数据
        3. 非坚持CSMA，立即发送数据，否则延迟一段随机的时间再重新监听
      - CSMA/CD：先听后发，边听边发，冲突停发，随机重发
      - CSMA/CA：主要用在无线局域网中
   3. 受控接入：不能随即地发送数据，一定要得到某种东西才有权发数据
3. 轮询访问介质访问控制（令牌传递协议）






