---
layout:     post
title:      计算机网络数据链路层
subtitle:   
date:       2019-9-30
author:     度朝腾
catalog: true
tags:
    - 计算机网络
---

### 一、数据链路层的功能：主要作用就是加强物理层传输原始比特流的功能，将物理层提供的可能出粗的物理连接改造为逻辑上无差错的数据链路，使其对网络层表现为无差错的链路

1. 为网络层提供服务：基本任务是将源机器中来自网络层的数据传输到目标机器的网络层
   - 无确认的无连接服务
   - 有确认的无连接服务
   - 有确认的面向连接服务
   - 有连接就一定有确认
2. 链路管理：数据链路层连接的建立、维持、释放过程称为链路管理
   - 主要用于面向连接的服务
   - 首先确认对方已处于就绪状态，并交换一些必要的信息以对帧序号初始化
   - 建立连接
   - 在传输过程中维持连接
   - 传输完毕释放该连接
3. 帧界定、帧同步、透明传输
   - 帧界定：确定帧的界限
   - 帧同步：接收方能从接收到的二进制比特流区分出帧的起始和终止
   - 不管数据是什么比特组合，都能在链路上传输
4. 流量控制
   - 限制发送方的数据流量，防止其发送速率超过接收方的接受能力
   - 控制的相邻两结点之间数据链路上的流量
5. 差错控制
   - 使发送方确定接收方是否正确收到其发送的数据的方法称为差错控制
   - 位错：帧中某些位产生差错，通常用循环冗余校验发现位错，通过自动重传请求方式来重传出错的帧
   - 帧错：帧的丢失、重复、失序等错误，引入定时器和编号机制，能保证每一帧最终都能且仅有一次正确地交付

### 二、组帧：数据链路层之所以把比特组合成帧为单位传输，是为了出错时只重发出错的帧，而不重发所有数据

1. 字符统计法（脆弱性）（计数字段也算进计数中）
   - 在帧头部使用一个计数字段来标明帧内字符数，可以确定帧结束的位置
   - **最大问题在于**如果计数字段出错，收发双方将失去同步，造成灾难性后果
2. 字符填充的首尾定界符法（复杂性）
   - 使用特定字符来定界一帧的开始与结束
   - 书上那啥DEL STX什么的，就是一个首尾标志，没有转义字符
   - DEL转义字符可以防止特殊字符的误判，并且只是一个字符而不是三个，特殊字符就是我们规定好的那些，不一定只有一个
3. 比特填充的首尾标志法
   - 用0111110来标志一帧的开始与结束
   - 发送方的数据链路层在信息位遇到五个连续的1时，自动在其后面插入一个0
   - 接收方没收到五个连续的1时，自动删除后面紧跟的0，恢复原信息
   - 性能优于字符填充法
4. 违规编码法
   - 利用违规（不使用的编码规则）编码来定界帧的起始和结束
   - 不需要采用任何填充技术，就能实现数据传输的**透明性**
   - 只适合采用冗余编码的特殊编码环境（有不使用的编码规则）

### 三、差错控制（传输中的差错基本都是有噪声引起的）

1. 两种噪声
   - 信道随机热噪声：提高信噪比来减少或避免
   - 外界特定短暂原因所造成的冲击噪声：**产生差错的重要原因**
2. 差错控制
   - 自动重传请求（ARQ）
   - 前向纠错（FEC）
3. 检错编码（哟哟哟，这不是计组嘛）
   - 奇偶校验码（去看计组）
   - 循环冗余码（去看计组）
4. 纠错编码
   - 海明码（去看计组）

### 四、流量控制与可靠传输机制

1. 基本方法是由接收方控制发送方发送数据的速率
2. 停止-等待流量控制基本原理（类似与发送窗口与接受窗口都只有1）
   - 发送方每发送一帧，都要等待接收方的应答信号，之后才发送下一帧
   - 接收方每接受一帧，都要反馈发送方一应答信号，表示可接受下一帧
   - 如果接收方一直不反馈应答信号，那么发送方就必须一直等待
   - 每次只允许发送一帧
   - **传输效率很低**
3. 滑动窗口流量控制基本原理
   - 在任意时刻，发送方都维持一组连续的允许发送的帧的信号，称为**发送窗口**
   - 在任意时刻，接收方都维持一组连续的允许接受的帧的信号，称为**接收窗口**
   - 发送窗口的大小代表还未收到对方确认信息的情况下发送方最多还可以发送多少个数据帧
   - 接受方只有收到的数据帧的序号落入接受窗口内才允许将该数据帧收下，其他的**丢弃**
   - 发送端每接受到一个确认帧，**发送窗口就向前滑动一个帧的位置**，当发送窗口内没有可以发送的帧时，发送方就会停止发送，直到收到接收方发送的**确认帧使窗口移动**，**窗口内有可以发送的帧的时候**，才开始继续发送
   - 接收端收到数据帧后，将窗口向前移动一个位置，并且返回确认帧
4. 可靠传输机制
   - 确认是一种**无数据**的控制帧，这种控制帧使得接收方可以让发送方知道哪些内容被正确接收
   - 为了提高效率，有时候将确认捎带在一个回复帧中，称为**捎带确认**
   - 超时重传是指发送方在发送某个数据帧后就开启一个计时器，在一定时间内如果没有得到发送的数据帧的确认帧，那么就重新发送该数据帧，**直到发送成功为止**
   - 自动重传请求：
     1. 停止-等待
     2. 后退N帧
     3. 选择性重传

### 五、单帧滑动窗口和停止-等待协议

1. 停止-等待协议可能出现的错误：
   - 数据帧丢失
   - 到达目的站的帧可以已经损坏，接收站检测出错误后，只是单纯地将该帧丢弃
   - 数据帧正确但是确认帧被破坏
   - 有详细规则描述，在书上有

### 六、多帧滑动窗口和后退N帧协议

1. 发送方无需在收到上一个帧的ACK后才能开始发送下一帧，可以连续发送帧
2. 当接收方检测出失序的信息帧后，要求发送方重发**最后一个能正确接收**的信息帧之后 的**所有未被确认的帧**
3. 当发送方发送N个帧后，若发现**该N个帧的前一个帧**在计时器超时后仍未返回其确认信息，则该帧被判为出错或丢失，此时发送方不得不重传**该出错帧及随后的N个帧**
4. 接收方只允许按顺序接受帧

### 七、多帧滑动窗口和选择重传协议

1. 为了进一步提高信道利用率，可以设法只重传出现差错的数据帧或计时器超时的数据帧
2. 但是此时必须加大接收窗口，以便收下发送序号不连续但仍处在接收窗口中的那些数据帧
3. 等到所缺序号的数据帧收到后再一并送交主机

### 八、介质访问控制

1. 主要任务：为使用介质的每个结点隔离来自同一信道上其他结点所传送的信号，以协调活动结点的传输
2. 用来决定广播信道中信道分配的协议属于数据链路层的一个子层，称为**介质访问控制（MAC）子层**
3. 内容：采取一定措施，使得两队结点之间的通信不会发生互相干扰的情况
4. **信道划分介质访问控制**
   1. 将使用介质的每个设备与来自同一通信信道上的其他设备的通信隔离开来，把时域和频域资源合理地分配给网络上的设备
   2. 多路复用技术：当传输介质的带宽超过传输单个信号所需的带宽时，人们通过一条介质上同时携带多个传输信号的方法来提高传输系统的利用率，这就是所谓的**多路复用**，也是实现**信道划分介质访问控制的途径**
   3. 采用多路复用技术可以把多个输入通道的信息整合到一个复用通道中，在接收端把收到的信息分离处理啊并传送到相应的输出通道
   4. 信道划分的实质就是通过分时、分频、分码等方法把原来的一条广播信道，逻辑上分为几条用于结点之间通信的互不干扰的子信道，**实际上就是把广播信道转变为点对点信道
   5. **频分多路复用（FDM）**
      - 频分多路复用是一种将**多路基带信号**调制到**不同频率载波上**，再叠加形成一个**复合信号**的多路复用技术。
      - 在物理信道的可用带宽超过单个原始信号所需带宽情况下，可将该物理信道的带宽分割成若干与传输单个信号带宽相同的子信道，每个子信道传输一种信号，这就是频分多路复用
      - 每个子信道分配的带宽可以不相同，但是它们的总和必须不超过信道的总带宽
      - **在实际应用中为了防止子信道之间的干扰，相邻信道之间需要加入保护频带**
      - 优点在于充分利用了传输介质的带宽，系统效率高；技术比较成熟，实现也比较容易
   6. **时分多路复用（TDM）**
      - 时分多路复用是将一条物理信道按时间分成若干时间片，轮流地分配给多个信号使用
      - 每个时间片由复用的一个信号占用，而不像FDM那样，同一时间同时发送多路信号
      - 统计时分多路复用（STDM称为异步时分多路复用）是TDM的改进，按需动态分配时隙，因此可以提高线路利用率
   7. **波分多路复用（WDM）**
      - 光的频分多路复用
      - 它在一根光纤中传输多种不同波长的光信号，由于波长不同，各路光信号互不干扰
      - 最后再用波长分解复用器将各路波长分解出来
      - 由于光波处于频谱的高频段，有很高的带宽，因而可以实现多路的波分复用
   8. **码分多路复用（CDM）**
      - 采用不同的编码来区分各路原始信号的一种复用方式
      - 既共享信道的频率，又共享时间
      - 码分多址（CDMA）：是码分复用的一种方式，原理是每比特时间被分为m个更短的时间槽，称为码片（chip），通常情况下每比特有64或128个码片，每个站点被指定一个唯一的m位代码或码片序列，惯例将码片中的0写为-1，将1写为+1，之后送达后会进行数据分离的操作
5. **随机访问介质访问控制**
   1. 不采用集中控制的方式解决发送信息的次序问题，所有用户能根据自己的意愿随机地发送信息，占用信道全部速率
   2. 为了解决随机接入发生的碰撞，每个用户需**按照一定的规则反复地重传它的帧**，直到该帧无碰撞地通过
   3. 上述的规则就是随机访问介质访问控制协议，协议的核心思想都是：胜利者通过争用获得信道，从而获得信息的发送权，因此随机访问介质访问控制协议又称为争用型协议
   4. 随机访问介质访问控制既不共享时间，也不共享空间，实质上是一种将广播信道转化为点到点信道的行为
   5. **ALOHA协议**
      - 纯ALOHA协议：当网络中任何一个站点需要发送数据时，可以不进行任何检测就发送数据，如果在一段时间内未收到确认，那么该站点就认为传输过程发送了冲突，等待一段时间再发送数据，**直到发送成功**。
      - 时隙ALOHA协议：把所有各站在时间上同步起来，并将时间划分为一段段等长的时隙，规定只能在**每个时隙开始时才能发送一个帧**，从而避免 用户发送数据的随意性，减少数据发生冲突的可能性，提高信道利用率
   6. **CSMA协议**
      - 每个站点都随心所欲的发送数据，即使其他站点正在发送也照发不误，发送碰撞的概率很大
      - 若每个站点在发送前先侦听一下公用信道，发现信道空闲后再发送，就会大大降低冲突的可能，提高信道利用率，载波侦听多路访问协议依据的就是这种思想
      - 1-坚持CSMA：一个结点要发送数据时，首先倾听信道；如果信道空闲，那么立即发送数据；如果信道忙，那么等待，同时继续侦听信道直到空闲；如果发生冲突，那么随机等待一段时间后，**再重新开始侦听信道**
      - 非坚持CSMA：一个结点要发送数据时，受限侦听信道，如果信道空闲，那么立即发送数据；**如果信道忙，那么放弃侦听，等待一个随机的时间后重复上述过程**
      - p-坚持CSMA（上述两种方法的折中方案）：用于时分信道，一个结点要发送数据时，受限侦听信道；如果信道忙，那么等待下一个时隙；如果信道空闲，那么以概率p发送数据，以概率1-p推迟到下一个时隙；如果下一个时隙信道仍然空闲，那么以概率p发送数据，以概率1-p推迟到下一个时隙；这个过程一直持续到数据发送成功，或因为其他结点发送数据而检测到信道忙为止，若是后者，则等待一个随机时间后**重新开始侦听**
   7. **CSMA/CD协议**：先听后发，边听边发，冲突停发，随机重发
   8. **CSMA/CA协议**
      - CSMA/CD虽然已经成功应用于使用有线连接的局域网，但在无线局域网环境下，却不能简单地搬用CSMA/CD协议，特别是碰撞检测部分：
        - 接受信号的强度往往会远小于发送信号的强度，且在无线介质上信号强度的动态变化范围很大，若要实现碰撞检测，硬件上的话费会很大
        - 在无线通信情况下，并非所有站点都能听见对方，即存在**隐蔽站**的情况
      - 对CSMA/CD协议进行了修改，由碰撞检测变成了碰撞避免，碰撞避免并不是指协议可以完全避免碰撞，而是尽量降低碰撞的概率
      - 二进制指数退避算法
      - 预约信道
      - ACK帧
      - RTS/CTS帧：可选的碰撞避免机制，主要用于解决无线网中的隐蔽站问题
      - 基本思想是发送数据时先广播告知其他结点，让其他结点在某段时间内不要发送数据，以免发生碰撞
6. **轮询访问介质访问控制：令牌传递协议**

   - 用户不能随机地发送信息，而是通过一个集中控制的监控站，以循环的方式轮询每个结点，再决定信道的分配。当结点使用信道时，其他结点都不能使用信道。
   - 在令牌传递协议中，一个令牌在各结点间以**某个固定次序交换**
   - 令牌是由一组特殊的比特组合而成的帧
   - 当环上的一个站希望传送帧时，必须等待令牌
   - 令牌只有一个，不会发生冲突
   - 传输介质的物理拓扑不必是一个环，但是令牌在设备间的**传递通路逻辑上必须是一个环**

### 九、局域网：指在一个较小的地理范围内，将各种计算机，外部设备和数据库等系统通过双绞线、同轴电缆等连接介质互相连接起来，组成资源与信息共享的计算机互联网络

1. 局域网的基本概念和体系结构
   - 为一个单位所拥有，且地理范围和站点数目均有限
   - 较高的数据传输率
   - 较低的时延和较低的误码率
   - 各站为平等关系而非主从关系
   - 能进行广播和组播？
2. 局域网的特性主要由三个元素决定：
   - 拓扑结构
   - 传输介质
   - 介质访问控制方式（最重要）
3. 三种特殊的局域网拓扑实现：
   - 以太网（目前使用最广泛的局域网），逻辑拓扑是总线形结构，物理拓扑是星形或拓展星形
   - 令牌环（IEEE 802.5），逻辑拓扑是环形结构，物理拓扑是星形结构
   - FDDI（光纤分布数字接口，IEEE 802.8），逻辑拓扑是环形结构，物理拓扑是双环结构
4. IEEE 802标准

   - 数据链路层拆分为两个子层：逻辑链路控制（LLC）子层与媒体接入控制子层（MAC）子层
   - MAC子层：向上层屏蔽对物理层访问的各种差异，提供对物理层的统一访问接口，主要功能包括组帧和拆卸帧，比特传输差错控制，透明传输
   - LLC子层与传输媒体无关，它向网络层提供无确认无连接、面向连接、带确认无连接、高速传送4中不同的连接服务
   - 由于以太网在局域网市场中取得垄断低位，几乎成为局域网的代名词，802委员会制定的LLC子层作用已经不大
5. 以太网与IEEE 802.3

   - IEEE 802.3标准描述物理层与数据链路层的MAC子层的实现方法
   - 以太网逻辑上采用总线形拓扑结构，信息以广播形式发送
   - 以太网简化了通信流程并使用CSMA/CD对总线进行访问控制
   - 以太网采用无连接的工作方式
   - 网络接口卡（网卡）：是**数据链路层网络组件**，是局域网中连接计算机与传输介质的接口
   - 全世界每块网卡在出厂时都有一个唯一的代码，称为介质访问控制地址（MAC），这个地址用于控制主机在网络上的数据通信，网卡控制着主机对介质的访问，因此网卡**也工作在物理层**
   - 每块网卡不都是有一个叫MAC的地址嘛，这玩意也叫物理地址；长6字节，一般用连字符（或冒号）分割的**6个十六进制数**表示，如**02-60-8c-e4-b1-21**，高24位为厂商代码，低24位为厂商自行分配的网卡序列号
   - 网卡从网络上每收到一个MAC帧，首先要用硬件检查MAC帧中的MAC地址，如果是发往本站的帧，那么就收下，否则丢弃
6. 高速以太网：速率达到或超过100Mb/s的以太网称为高速以太网

   1. 100BASE-T以太网
   2. 吉比特以太网
   3. 10吉比特以太网
7. IEEE 802.11：是无线局域网的一系列协议标准，包括802.11a，802.11b等，他们制定了MAC层协议，运行在多个物理层标准上

   1. 802.11的MAC层采用CSMA/CA协议进行介质访问控制
   2. 在无线局域网中，即使在发送过程中发送了碰撞，也要把整个帧发送完毕，而在有线局域网中，发生冲突则结点立即停止发送数据。
   3. 无线区域网可以分为两大类
      - 固定基础设施无线局域网
      - 无固定基础设施无线局域网自组织网络
8. 令牌环网的基本原理
   1. 令牌环网的每一站通过电缆与环接口干线耦合器（TCU）相连。
   2. 环接口干线耦合器主要作用是传递所有经过的帧，为接入站发送和接受数据提供接口，并且TCU有两个状态：收听状态和发送状态
   3. 令牌实际上是一个特殊格式的MAC控制帧，本身并不含有信息，只控制信道的使用，确保在同一时刻只有一个结点能独占信道
   4. 传递过程：
      - 网络空闲时，环路中只有令牌帧在循环传递
      - 令牌传递到有数据要发送的站点处时，该站点就修改令牌中的一个标志位，并在令牌中附加自己需要传输的数据，将令牌变成一个数据帧，然后将这个数据帧发送出去
      - 数据帧沿环路传输，接受到的站点一边转发数据，一边查看帧的目的地址，如果目的地址和自己的地址相同，那么接收站就复制该数据帧以便进一步处理
      - 数据帧沿着环路传输，直到到达该帧的源站点，源站点接收到自己发出去的数据帧后便不再进行转发。同时，发送方可以通过检验返回的数据帧来查看数据传输过程中是否有错，若有错重传该帧
      - 源站点传送完数据后，重新产生一个令牌，并将令牌传递给下一个站点，以交出对媒体的访问权限
      - 物理上采用星形拓扑结构，逻辑上是环形拓扑结构，标准由802.5制定

### 十、广域网

1. 广域网的基本概念：通常是指覆盖范围很广的长距离网络（远超一个城市的范围）。广域网是因特网的核心部分，其任务是长距离运送主机发送的数据。广域网受限要考虑的问题是通信容量必须足够大，以便支持日益增长的通信量
2. 广域网不等同于互联网，互联网可以连接不同类型的网络，通常使用路由器来连接
3. 广域网由一些结点交换机（不是路由器，结点交换机和路由器都用来转发分组，它们的工作原理也类似，结点交换机在单个网络中转发分组，路由器在多个网络构成的互联网中转发分组）及连接这些交换机的链路构成。
4. 为了提高网络的可靠性，通常一个结点交换机往往与多个结点相连
5. 广域网一个重要问题是路由选择和分组转发。路由选择协议负责搜索分组从某个结点到目的结点的最佳传输路由，以便构造路由表，然后从路由表再构造出转发分组的转发表。分组是通过转发表转发的
6. **PPP协议**（面向字节）
   1. 该协议应用在直接连接两个结点的链路上
   2. 设计的目的主要是通过拨号或专线方式建立点对点连接发送数据
   3. PPP协议有三个组成部分：
      - 链路控制协议（LCP）
      - 网络控制协议（NCP）
      - 一个将IP数据报封装到串行链路的方法
7. **HDLC协议**
   1. 高级数据链路控制协议是ISO制定的面向比特的数据链路层协议











